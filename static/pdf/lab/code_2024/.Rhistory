? nflplotR::scale_color_nfl
install.packages("nflplotR")
library(nflplotR)
nflplotR::scale_color_nfl
nflplotR::scale_color_nfl
?nflplotR::scale_color_nfl
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med)) +
nflplotR::scale_color_nfl()
### packages
library(tidyverse)
library(nflfastR)
library(nflplotR)
library(rstan)
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med)) +
nflplotR::scale_color_nfl()
### ggplot settings
theme_set(theme_bw())
theme_update(text = element_text(size=25))
theme_update(plot.title = element_text(hjust = 0.5))
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med)) +
nflplotR::scale_color_nfl()
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med)) +
nflplotR::scale_color_nfl(type = "secondary")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
nflplotR::scale_color_nfl(type = "secondary")
?scale_color_nfl
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "secondary") +
ylab("")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "secondary") +
ylab("posterior team rating\naccording to the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "secondary") +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
# scale_color_nfl(type = "secondary") +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "secondary", labels=TRUE) +
ylab("posterior team rating\n from the Glickman Stern model")
?scale_color_nfl
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "secondary", labels=waiver() ) +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "secondary", labels=NULL ) +
ylab("posterior team rating\n from the Glickman Stern model")
?scale_color_nfl
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "secondary", labels=NULL ) +
scale_fill_nfl(alpha = 0.4) +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "secondary", labels=NULL ) +
# scale_fill_nfl(alpha = 0.4) +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "secondary", labels=NULL ) +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "primary", labels=NULL ) +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "primary", labels=team ) +
ylab("posterior team rating\n from the Glickman Stern model")
team
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "primary", labels=team ) +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
scale_color_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
geom_point(aes(y = post_med)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl() +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
geom_nfl_logos(aes(y = post_med)) +
scale_color_nfl(type = "primary") +
# scale_fill_nfl() +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
geom_nfl_logos(aes(team_abbr = team, y = post_med)) +
scale_color_nfl(type = "primary") +
# scale_fill_nfl() +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
# geom_line(aes(y = post_med), linewidth=1) +
geom_nfl_logos(aes(team_abbr = team, y = post_med)) +
scale_color_nfl(type = "primary") +
# scale_fill_nfl() +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
# geom_line(aes(y = post_med), linewidth=1) +
geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.065, alpha = 0.7)) +
scale_color_nfl(type = "primary") +
# scale_fill_nfl() +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05, alpha = 1)) +
scale_color_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, post_upper=x2), alpha=0.5) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.5) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.1) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl() +
ylab("posterior team rating\n from the Glickman Stern model")
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div, nrow=2) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl() +
ylab("posterior team rating\n from the Glickman Stern model")
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div, nrow=4) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl() +
ylab("posterior team rating\n from the Glickman Stern model")
df_betas_0 %>%
ggplot(aes(x = season, color=team)) +
facet_wrap(~ div, nrow=4) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
df_betas_0 %>%
ggplot(aes(x = season, color=team, fill=team)) +
facet_wrap(~ div, nrow=4) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
### plot
plot_betas =
df_betas_0 %>%
ggplot(aes(x = season, color=team, fill=team)) +
facet_wrap(~ div, nrow=4) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
plot_betas
ggsave("plots/plot_betas_glickmanStern.csv", plot_betas,
width=20, height=10)
ggsave("plots/plot_betas_glickmanStern.png", plot_betas,
width=20, height=10)
### plot
plot_betas =
df_betas_0 %>%
ggplot(aes(x = season, color=team, fill=team)) +
facet_wrap(~ div, nrow=2) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
# plot_betas
ggsave("plots/plot_betas_glickmanStern.png", plot_betas,
width=20, height=10)
df_params_1 =
tibble(
param = rownames(df_params_0),
# post_lower = df_params_0[,"2.5%"],
post_lower = df_params_0[,"25%"],
post_med = df_params_0[,"50%"],
post_upper = df_params_0[,"75%"],
# post_upper = df_params_0[,"97.5%"],
)
df_params_1
df_params_2 =
df_params_1 %>%
filter(!str_detect(param, "betas") & !str_detect(param, "lp__"))
df_params_2
map_team_to_div = tibble(
team = map_team_to_idx$team,
div = c(
"NFC West", "NFC South", "AFC North", "AFC East",
"NFC South", "NFC North", "AFC North", "AFC North",
"NFC East", "AFC West", "NFC North", "NFC North",
"AFC South", "AFC South", "AFC South", "AFC West",
"NFC West", "AFC West", "AFC West", "AFC East",
"NFC North", "AFC East", "NFC South", "NFC East",
"AFC East", "NFC East", "AFC North", "NFC West",
"NFC West", "NFC South", "AFC South", "NFC East"
)
)
data.frame(map_team_to_div %>% arrange(div, team))
df_betas_0 =
df_params_1 %>%
filter(str_detect(param, "betas")) %>%
mutate(
idxs = str_remove(param, "betas"),
idxs = str_remove(idxs, "\\["),
idxs = str_remove(idxs, "\\]"),
) %>%
rowwise() %>%
mutate(
team_idx = as.numeric(str_split(idxs, ",")[[1]][1]),
S = as.numeric(str_split(idxs, ",")[[1]][2])
) %>%
ungroup() %>%
left_join(
map_team_to_idx %>% rename(team_idx = idx),
) %>%
mutate(season = min(df0$season) + S - 1) %>%
left_join(map_team_to_div)
df_betas_0
### plot
plot_betas =
df_betas_0 %>%
ggplot(aes(x = season, color=team, fill=team)) +
facet_wrap(~ div, nrow=2) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
ylab("posterior team rating\n from the Glickman Stern model")
# plot_betas
ggsave("plots/plot_betas_glickmanStern.png", plot_betas,
width=20, height=10)
### plot
plot_betas =
df_betas_0 %>%
ggplot(aes(x = season, color=team, fill=team)) +
facet_wrap(~ div, nrow=2) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
theme(panel.spacing = unit(2, "lines")) +
ylab("posterior team rating\n from the Glickman Stern model")
# plot_betas
ggsave("plots/plot_betas_glickmanStern.png", plot_betas,
width=20, height=10)
# plot_betas
ggsave("plots/plot_betas_glickmanStern.png", plot_betas,
width=20, height=8)
### plot
plot_betas =
df_betas_0 %>%
ggplot(aes(x = season, color=team, fill=team)) +
facet_wrap(~ div, nrow=2) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
theme(panel.spacing = unit(2, "lines")) +
labs(title="posterior median team ratings\nwith ribbons for 50% credible intervals") +
ylab("posterior team rating\n from the Glickman Stern model")
# plot_betas
ggsave("plots/plot_betas_glickmanStern.png", plot_betas,
width=20, height=8)
### plot
plot_betas =
df_betas_0 %>%
ggplot(aes(x = season, color=team, fill=team)) +
facet_wrap(~ div, nrow=2) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
theme(panel.spacing = unit(2, "lines")) +
labs(title="posterior median team ratings, with ribbons for 50% credible intervals") +
ylab("posterior team rating\n from the Glickman Stern model")
# plot_betas
ggsave("plots/plot_betas_glickmanStern.png", plot_betas,
width=20, height=8)
### plot
plot_betas =
df_betas_0 %>%
ggplot(aes(x = season, color=team, fill=team)) +
facet_wrap(~ div, nrow=2) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
# geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) +
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
theme(panel.spacing = unit(2, "lines")) +
labs(subtitle="posterior median team ratings, with ribbons for 50% credible intervals") +
ylab("posterior team rating\n from the Glickman Stern model")
# plot_betas
ggsave("plots/plot_betas_glickmanStern.png", plot_betas,
width=20, height=8)
### plot
plot_betas =
df_betas_0 %>%
ggplot(aes(x = season, color=team, fill=team)) +
facet_wrap(~ div, nrow=2) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05)) + ###
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
theme(panel.spacing = unit(2, "lines")) +
labs(subtitle="posterior median team ratings, with ribbons for 50% credible intervals") +
ylab("posterior team rating\n from the Glickman Stern model")
# plot_betas
ggsave("plots/plot_betas_glickmanStern.png", plot_betas,
width=20, height=8)
### plot
plot_betas =
df_betas_0 %>%
ggplot(aes(x = season, color=team, fill=team)) +
facet_wrap(~ div, nrow=2) +
geom_line(aes(y = post_med), linewidth=1) +
geom_line(aes(y = post_lower), linewidth=0.5, linetype="dotted") +
geom_line(aes(y = post_upper), linewidth=0.5, linetype="dotted") +
geom_ribbon(aes(ymin=post_lower, ymax=post_upper), alpha=0.2) +
geom_nfl_logos(aes(team_abbr = team, y = post_med, width = 0.05), alpha=0.5) + ###
scale_color_nfl(type = "primary") +
scale_fill_nfl(type = "primary") +
theme(panel.spacing = unit(2, "lines")) +
labs(subtitle="posterior median team ratings, with ribbons for 50% credible intervals") +
ylab("posterior team rating\n from the Glickman Stern model")
# plot_betas
ggsave("plots/plot_betas_glickmanStern.png", plot_betas,
width=20, height=8)
